---
title: "Encuesta 2024"
author: "C치tedra de Estad칤stica II - FCS - UNC"
date: "`r Sys.Date()`"
output: html_document
---

## Cargamos la base de datos

Para descargar la base de datos de la encuesta, utilizaremos la funci칩n googlesheets4(). Esta funci칩n permite conectarse directamente a una hoja de c치lculo en Google y bajarla directamente al entorno de trabajo en R. Dentro de esta funci칩n se debe agregar como argumento el link a la hoja de c치lculo correspondiente, en este caso es (s칩lo podr치n acceder con su cuenta UNC):

https://docs.google.com/spreadsheets/d/1FW4EtmIWLB5bo0mXUDiOGJeI9g6uCTxEM00clT2V9ug/edit?usp=sharing

Una vez que ejecuten las siguientes l칤neas, se abrir치 el navegador web. All칤 deber치n loguearse con su cuenta de gmail "mi.unc.edu.ar" y luego retornar al entorno de R.

```{r, warning=FALSE, message=FALSE}
# install.packages("googlesheets4")
library(googlesheets4)
datos <- read_sheet('https://docs.google.com/spreadsheets/d/1FW4EtmIWLB5bo0mXUDiOGJeI9g6uCTxEM00clT2V9ug/edit?usp=sharing')
```

## Analizamos algunos datos b치sicos

En primer lugar, exploramos cu치les son las variables (cu치les son las columnas) de nuestra base de datos.

```{r, warning=FALSE, message=FALSE}
names(datos)
```

쮺u치ntas encuestas hemos realizado? Si bien podemos verlo directamente en el panel "environment" de Rstudio (arriba a la derecha), la funci칩n nrow() nos permite conocer la cantidad de filas que tiene una tabla. Por lo tanto: 

```{r, warning=FALSE, message=FALSE}
nrow(datos)
```
Como vemos, hasta el momento nuestra encuesta ha recibido  `r nrow(datos)` respuestas.

Veamos un poco m치s de cerca a la variable "edad", que hace referencia a la edad de la persona encuestada. En primer lugar, nos interesa saber con qu칠 tipo de datos estamos tratanto (se trata de una variable num칠rica? categ칩rica?)

```{r, warning=FALSE, message=FALSE}
class(datos$edad)
```
Como vemos, es una variable num칠rica. Por lo tanto, podemos calcular algunas medidas de tendencia central para analizar su distribuci칩n. La funci칩n summary() nos permite conocer cu치les son los cuartiles y la media de esta variable.

```{r, warning=FALSE, message=FALSE}
summary(datos$edad)
```

Con la funci칩n sd() podemos conocer cu치l es la desviaci칩n est치ndar de esta variable.

```{r, warning=FALSE, message=FALSE}
sd(datos$edad)
```

Si queremos calcular el coeficiente de variaci칩n, tambi칠n podemos hacerlo, pero debemos calcularlo. Como sabemos, esta medida de dispersi칩n se calcula haciendo el cociente entre la desviaci칩n est치ndar y la media, entonces:

```{r, warning=FALSE, message=FALSE}
sd(datos$edad) / mean(datos$edad)
```

Tambi칠n podemos visualizar un histograma de la distribuci칩n de esta variable haciendo:

```{r, warning=FALSE, message=FALSE}
hist(datos$edad)
```

Veamos ahora un poco m치s de cerca a la variable que captura la identidad de g칠nero de las personas encuestadas. Qu칠 tipo de variable es? Se pueden calcular medidas de posici칩n y de dispersi칩n sobre esta variable?

```{r, warning=FALSE, message=FALSE}
class(datos$genero)
```
Como vemos, se trata de una variable categ칩rica. Para describirla, podemos utilizar la funci칩n table(), que informa la cantidad de casos que contiene cada categor칤a (es decir, la frecuencia absoluta):

```{r, warning=FALSE, message=FALSE}
table(datos$genero)
```

Si quisieramos ver las frecuencias relativas en vez de las frecuencias absolutas, "envolvemos" a la funci칩n table() utilizada anteriormente, con la funci칩n prop.table(), de la siguiente manera:

```{r, warning=FALSE, message=FALSE}
prop.table(table(datos$genero))
```
La tabla original de frecuencuas absolutas es muy r칰stica. Para hacerla visualmente m치s agradable, podemos hacer uso de la funci칩n kable(). Nuevamente, si "envolvemos" a la funci칩n table() original con la funci칩n kable(), tenemos lo siguiente:

```{r, warning=FALSE, message=FALSE}
# install.packages("kableExtra")
library(kableExtra)
kable(table(datos$genero))
```

Como vemos, la nombre de la primera columna es "Var1", y eso queda poco prolijo. Si queremos cambiar el nombre de esta columna, dentro de la funci칩n kable() utilizamos el argumento "col.names" de la siguiente manera:

```{r, warning=FALSE, message=FALSE}
kable(table(datos$genero), col.names = c("G칠nero", "Frecuencia"))
```

### Usando "pipes"...

Una manera diferente de hacer la misma tabla es utilizando "pipes". Como se puede ver en el c칩digo anterior, hay dos funciones anidadas. Es decir, la funci칩n kable() tiene como argumento a otra funci칩n, table(). Hay una funci칩n dentro de otra. Cuando enfrentamos este tipo de fen칩menos que requieren una funci칩n dentro de otra, puede ser conveniente (o al menos m치s ordenado) hacer uso de los pipes (%>%). Este artificio permite expresar las dependencias entre funciones de manera secuencial sin generar l칤neas de c칩digo tan extensas y plagadas de par칠ntesis. Entonces, en este caso, se expresa primero la funci칩n table(), luego el "pipe" (cuyo atajo en el teclado es ctrl+shit+m) y luego la funci칩n kable() con sus correspondientes arguementos (col.names):

```{r, warning=FALSE, message=FALSE}
# install.packages("tidyverse")
library(tidyverse)
table(datos$genero) %>% kable(col.names = c("G칠nero", "Frecuencia"))
```

> 游닇 *쯇ueden replicar estas tablas para las variables que indican el voto de las personas encuestadas en las elecciones generales y en el balotaje?*

<br></br>

## Imagen de figuras pol칤ticas


### Javier Milei

En primer lugar, observamos que la variable "imagen_milei" no es num칠rica, dado que en la lista de opciones para responder hab칤an palabras como "no s칠" y "no lo conozco". Por lo tanto, para calcular una medida n칰merica de tendencia central como la media o la mediana, necesitamos, primero, convertirla en una variable num칠rica; esto se logra mediante la funci칩n "as.numeric". Luego de esto ya estamos en condiciones de analizar su distribuci칩n:

```{r, warning=FALSE, message=FALSE}
datos$imagen_milei = as.numeric(datos$imagen_milei)
summary(datos$imagen_milei)
hist(datos$imagen_milei)
```

### Juan Grabois

El histograma anterior ten칤a algunas cuestiones de formato que ser칤a conveniente corregir. El t칤tulo indicaba "Histogram of datos$imagen_milei". Si quisieramos expresarlo en espa침ol, y sin las expresiones de c칩digo como el s칤mbolo \$, debemos hacer uso del argumento "main" en la funci칩n "hist()".

```{r, warning=FALSE, message=FALSE}
datos$imagen_grabois = as.numeric(datos$imagen_grabois)
summary(datos$imagen_grabois)
hist(datos$imagen_grabois, main = "Histograma de la imagen del candidato")
```

### Patricia Bullrich

Si bien en el histograma anterior corregimos el t칤tulo del gr치fico, a칰n quedan expresiones a corregir en los nombres de los ejes. Si deseamos reemplazar el t칤tulo del eje vertical de "Frecuency" a "Frecuencia", hacemos uso del argumento "ylab" de la funci칩n hist(). De igual manera, si queremos modificar el nombre del eje horizontal, hacemos uso del argumento "xlab" de la funci칩n hist(). Finalmente, si deseamos modificar el color de las barras, por ejemplo, hacemos uso del argumento "col" en la funci칩n hist().

```{r, warning=FALSE, message=FALSE}
datos$imagen_bullrich = as.numeric(datos$imagen_bullrich)
summary(datos$imagen_bullrich)
hist(datos$imagen_bullrich, main = "Histograma de la imagen de la candidata", ylab =  "Frecuencia", xlab = "Puntaje", col = "lightblue")
```

> 游닇 *쯇ueden calcular la imagen para el resto de las figuras pol칤ticas?*

> 游닇 *쮺u치l es la figura con mejor imagen en C칩rdoba? 쯏 la peor?*

<br></br>
<br></br>

## An치lisis seg칰n diferentes grupos

Veamos la imagen de Javier Milei seg칰n la identidad de g칠nero de las personas encuestadas. Comencemos por analizar s칩lo aquellas personas cuya identidad de g칠nero sea "mujer".

```{r, warning=FALSE, message=FALSE}
mujeres = filter(datos, datos$genero == "mujer")
```

Utilizando la funci칩n filter() hemos creado un nuevo objeto consistente en un dataframe con `r nrow(mujeres)` observaciones y `r ncol(mujeres)`. Como es esperable, entonces, el nuevo objeto tiene la misma estructura que la base de datos original, s칩lo que menos filas, dado que est치 compuesto s칩lo por aquellas personas cuya identidad de g칠nero es "mujer".

Ahora calculamos la media de la imagen: 

```{r, warning=FALSE, message=FALSE}
mean(mujeres$imagen_milei, na.rm = TRUE)
```
<br></br>

#### Entre las personas cuya identidad de g칠nero es "mujer", 쯟a imagen de Javier Milei es m치s alta o m치s baja que la observada en la poblaci칩n general?

> 游닇 *쯏 si replicamos el an치lisis para cada una de las categor칤as de la variable "genero"?*

> 游닇 *쯈u칠 sucede respecto a la imagen del resto de las figuras pol칤ticas que consideramos en la encuesta? 쮿ay diferencias en la valoraci칩n entre diferentes indentidades de g칠nero?*

<br></br>

Veamos ahora la imagen de Juan Grabois entre las personas menores de 30 a침os. Para ello, replicamos el an치lisis anterior, pero creamos una nueva base de datos "filtrando" por edad. Entonces:

```{r, warning=FALSE, message=FALSE}
menores_30 = filter(datos, datos$edad < 30)
mean(menores_30$imagen_grabois, na.rm = TRUE)
```

Ahora comparemos con el escenario para las personas de m치s de 50 a침os:

```{r, warning=FALSE, message=FALSE}
mayores_50 = filter(datos, datos$edad > 50)
mean(mayores_50$imagen_grabois, na.rm = TRUE)
```

<br></br> 

> 游닇 *쯈u칠 sucede en el caso de personas cuya edad est치 comprendida entre los 30 y los 50 a침os?*

> 游닇 *쯈u칠 observamos para el resto de las figuras pol칤ticas?*


<br></br> 

Analicemos ahora qu칠 puntaje le asignan las personas encuestadas al problema de la inflaci칩n, considerando s칩lo aquellas cuya identidad de g칠nero es "var칩n" y tienen menos de 30 a침os. Para ello, debemos agregar esta condici칩n compuesta a la funci칩n filter(). Para unir estas dos condiciones haremos uso del operador l칩gico *&*, entendido como "y": varones "y" menores de 30. 

```{r, warning=FALSE, message=FALSE}
grupo = filter(datos, datos$edad < 30 & datos$genero == "var칩n")
mean(grupo$problemas_inflacion, na.rm = TRUE)
```
Veamos ahora que sucede si consideramos s칩lo aquellas personas cuya identidad de g칠nero es "var칩n", pero tienen m치s de 60 a침os.

```{r, warning=FALSE, message=FALSE}
grupo = filter(datos, datos$edad > 60 & datos$genero == "var칩n")
mean(grupo$problemas_inflacion, na.rm = TRUE)
```
<br></br>

> 游닇 *쯇odemos afirmar que existen diferencias en la valoraci칩n del problema entre estos dos grupos?  Para responder a la pregunta anterior, debemos hacer uso de los <b>intervalos de confianza</b>*


## Construyendo intervalos de confianza

Como sabemos, los l칤mites de un intervalo de confianza para la media vienen dados por las siguientes expresiones:

$$ limite \ inferior = \bar{x} - z_{\alpha / 2} \ \frac{s}{\sqrt n} $$
$$ limite \ superior = \bar{x} + z_{\alpha / 2} \ \frac{s}{\sqrt n} $$

En donde:

$\bar{x}$ es la media muestral de la variable aleatoria sobre la que estamos intentando estimar el intervalo de confianza.

$z_{\alpha / 2}$ es el puntaje z asociado al nivel de confianza $(1-\alpha)$ (o lo que es lo mismo, al nivel de significaci칩n $\alpha$).

$s$ es la desviaci칩n est치ndar muestral.

$n$ es el tama침o de la muestra.

> 游닇 *쯇or qu칠 estamos utilizando la desviaci칩n est치ndar muestral ($s$) y no la observada en la poblaci칩n ($\sigma$)?*

Por lo tanto, si queremos estimar el intervalo de confianza de la media de la variable aleatoria `r names(datos)[[3]]`, procedemos a calcular cada uno de estos elementos. Entonces:

```{r, warning=FALSE, message=FALSE}
x = mean(datos$edad)
s = sd(datos$edad)
n = nrow(datos)
```

En donde la funci칩n *nrow()* devuelve la cantidad de filas que tiene un dataframe, es decir, la cantidad de observaciones.

Si utilizamos un nivel de confianza igual al 0.95 (o lo que es igual, un nivel de significaci칩n igual a 0.05), sabemos que el puntaje $z_{\alpha / 2}$ asociado a esta probabilidad es igual a 1.96. Por lo tanto:

```{r, warning=FALSE, message=FALSE}
limite_inferior = x - 1.96 * (s / sqrt(n) )
limite_superior = x + 1.96 * (s / sqrt(n) )
```

Por lo tanto, podemos afirmar, con un nivel de confianza igual a 0.95, que la media **poblacional** de la variable aleatoria `r names(datos)[[3]]` se encuentra comprendida entre `r round(limite_inferior,3)` y `r round(limite_superior,3)`

Una forma m치s simple de realizar el c치lculo anterior consiste en utilizar la librer칤a "gmodels". Para ello, primero instalamos la librer칤a (borrando el # que se encuentra al comienzo de la l칤nea de c칩digo), luego cargamos la librer칤a al entorno de trabajo y utilizamos la funci칩n ci() para calcular los l칤mites del intervalo:

```{r, warning=FALSE, message=FALSE}
# install.packages("gmodels")
library(gmodels)
ci(datos$edad, confidence=0.95)
```
Como se puede apreciar, el resultado de la funci칩n nos informa sobre el valor del estimador puntual $\bar{x}$, el l칤mite inferior (CI lower), el l칤mite superior (CI upper) y el error est치ndar de la estimaci칩n.

Vamos a proceder a replicar el c치lculo para la clasificaci칩n de problemas, concretamente para analizar c칩mo eval칰an las persinas encuestadas al problema de la inflaci칩n y al problema del desempleo:

```{r, warning=FALSE, message=FALSE}
ci(datos$problemas_inflacion, confidence=0.95)
```
Por lo tanto, podemos afirmar, con un nivel de confianza de 0.95, que en la poblaci칩n el promedio de la valoraci칩n de la inflaci칩n se encuentra entre `r round(ci(datos$problemas_inflacion, confidence=0.95)[[2]],3)` y `r round(ci(datos$problemas_inflacion, confidence=0.95)[[3]],3)`.

Veamos ahora qu칠 sucede respecto del desempleo:

```{r, warning=FALSE, message=FALSE}
ci(datos$problemas_desempleo, confidence=0.95)
```

En consecuencia, podemos afirmar, con un nivel de confianza de 0.95, que en la poblaci칩n el promedio de la valoraci칩n del desempleo se encuentra entre `r round(ci(datos$problemas_desempleo, confidence=0.95)[[2]],3)` y `r round(ci(datos$problemas_desempleo, confidence=0.95)[[3]],3)`.

> 游닇 *En base a los resultados anteriores, teniendo en cuenta que la media muestral de la valoraci칩n de la inflaci칩n es igual a `r round(ci(datos$problemas_inflacion, confidence=0.95)[[1]],3)`, y la media muestral de la valoraci칩n del desempleo es igual a `r round(ci(datos$problemas_desempleo, confidence=0.95)[[1]],3)`; 쯇odemos afirmar que la inflaci칩n es un problema m치s relevante que el desempleo? 쯇or qu칠?*

Para responder a la pregunta anterior, va una peque침a ayuda visual:

```{r, warning=FALSE, message=FALSE, include=TRUE, echo=FALSE}
aux = data.frame(Problema = c("Inflacion", "Desempleo"),
                 Valoracion = c(ci(datos$problemas_inflacion, confidence=0.95)[[1]], ci(datos$problemas_desempleo, confidence=0.95)[[1]]),
                 low = c(ci(datos$problemas_inflacion, confidence=0.95)[[2]], ci(datos$problemas_desempleo, confidence=0.95)[[2]]),
                 up = c(ci(datos$problemas_inflacion, confidence=0.95)[[3]], ci(datos$problemas_desempleo, confidence=0.95)[[3]]))
library(ggplot2)
ggplot(aux, aes(Problema, Valoracion)) + geom_point() +  
geom_errorbar(aes(ymin = low, ymax = up)) + coord_flip()
                   
```

> 游닇 *쯈u칠 sucede si, en vez de un nivel de confianza de 0.95, utilizamos un nivel de confianza igual a 0.99? 쯃os intervalos son m치s amplios o m치s angostos? 쯃a estimaci칩n es m치s precisa o menos precisa?*

> 游닇 *쯏 si replicamos el an치lisis para el resto de los problemas? 쮿ay alguno que efectivamente sea m치s importante (o menos importante) que el resto?*

> 游닇 *Aplicando el mismo an치lisis, 쯈u칠 podemos afirmar sobre la imagen de cada una de las figuras pol칤ticas relevadas?*

<br></br>
<br></br>