---
title: "Encuesta 2024"
author: "Cátedra de Estadística II - FCS - UNC"
date: "`r Sys.Date()`"
output: html_document
---

## Cargamos la base de datos

Para descargar la base de datos de la encuesta, utilizaremos la función googlesheets4(). Esta función permite conectarse directamente a una hoja de cálculo en Google y bajarla directamente al entorno de trabajo en R. Dentro de esta función se debe agregar como argumento el link a la hoja de cálculo correspondiente, en este caso es (sólo podrán acceder con su cuenta UNC):

https://docs.google.com/spreadsheets/d/1FW4EtmIWLB5bo0mXUDiOGJeI9g6uCTxEM00clT2V9ug/edit?usp=sharing

Una vez que ejecuten las siguientes líneas, se abrirá el navegador web. Allí deberán loguearse con su cuenta de gmail "mi.unc.edu.ar" y luego retornar al entorno de R.

```{r, warning=FALSE, message=FALSE}
# install.packages("googlesheets4")
library(googlesheets4)
datos <- read_sheet('https://docs.google.com/spreadsheets/d/1FW4EtmIWLB5bo0mXUDiOGJeI9g6uCTxEM00clT2V9ug/edit?usp=sharing')
```

## Analizamos algunos datos básicos

En primer lugar, exploramos cuáles son las variables (cuáles son las columnas) de nuestra base de datos.

```{r, warning=FALSE, message=FALSE}
names(datos)
```

¿Cuántas encuestas hemos realizado? Si bien podemos verlo directamente en el panel "environment" de Rstudio (arriba a la derecha), la función nrow() nos permite conocer la cantidad de filas que tiene una tabla. Por lo tanto: 

```{r, warning=FALSE, message=FALSE}
nrow(datos)
```
Como vemos, hasta el momento nuestra encuesta ha recibido  `r nrow(datos)` respuestas.

Veamos un poco más de cerca a la variable "edad", que hace referencia a la edad de la persona encuestada. En primer lugar, nos interesa saber con qué tipo de datos estamos tratanto (se trata de una variable numérica? categórica?)

```{r, warning=FALSE, message=FALSE}
class(datos$edad)
```
Como vemos, es una variable numérica. Por lo tanto, podemos calcular algunas medidas de tendencia central para analizar su distribución. La función summary() nos permite conocer cuáles son los cuartiles y la media de esta variable.

```{r, warning=FALSE, message=FALSE}
summary(datos$edad)
```

Con la función sd() podemos conocer cuál es la desviación estándar de esta variable.

```{r, warning=FALSE, message=FALSE}
sd(datos$edad)
```

Si queremos calcular el coeficiente de variación, también podemos hacerlo, pero debemos calcularlo. Como sabemos, esta medida de dispersión se calcula haciendo el cociente entre la desviación estándar y la media, entonces:

```{r, warning=FALSE, message=FALSE}
sd(datos$edad) / mean(datos$edad)
```

También podemos visualizar un histograma de la distribución de esta variable haciendo:

```{r, warning=FALSE, message=FALSE}
hist(datos$edad)
```

Veamos ahora un poco más de cerca a la variable que captura la identidad de género de las personas encuestadas. Qué tipo de variable es? Se pueden calcular medidas de posición y de dispersión sobre esta variable?

```{r, warning=FALSE, message=FALSE}
class(datos$genero)
```
Como vemos, se trata de una variable categórica. Para describirla, podemos utilizar la función table(), que informa la cantidad de casos que contiene cada categoría (es decir, la frecuencia absoluta):

```{r, warning=FALSE, message=FALSE}
table(datos$genero)
```

Si quisieramos ver las frecuencias relativas en vez de las frecuencias absolutas, "envolvemos" a la función table() utilizada anteriormente, con la función prop.table(), de la siguiente manera:

```{r, warning=FALSE, message=FALSE}
prop.table(table(datos$genero))
```
La tabla original de frecuencuas absolutas es muy rústica. Para hacerla visualmente más agradable, podemos hacer uso de la función kable(). Nuevamente, si "envolvemos" a la función table() original con la función kable(), tenemos lo siguiente:

```{r, warning=FALSE, message=FALSE}
# install.packages("kableExtra")
library(kableExtra)
kable(table(datos$genero))
```

Como vemos, la nombre de la primera columna es "Var1", y eso queda poco prolijo. Si queremos cambiar el nombre de esta columna, dentro de la función kable() utilizamos el argumento "col.names" de la siguiente manera:

```{r, warning=FALSE, message=FALSE}
kable(table(datos$genero), col.names = c("Género", "Frecuencia"))
```

### Usando "pipes"...

Una manera diferente de hacer la misma tabla es utilizando "pipes". Como se puede ver en el código anterior, hay dos funciones anidadas. Es decir, la función kable() tiene como argumento a otra función, table(). Hay una función dentro de otra. Cuando enfrentamos este tipo de fenómenos que requieren una función dentro de otra, puede ser conveniente (o al menos más ordenado) hacer uso de los pipes (%>%). Este artificio permite expresar las dependencias entre funciones de manera secuencial sin generar líneas de código tan extensas y plagadas de paréntesis. Entonces, en este caso, se expresa primero la función table(), luego el "pipe" (cuyo atajo en el teclado es ctrl+shit+m) y luego la función kable() con sus correspondientes arguementos (col.names):

```{r, warning=FALSE, message=FALSE}
# install.packages("tidyverse")
library(tidyverse)
table(datos$genero) %>% kable(col.names = c("Género", "Frecuencia"))
```

#### ¿Pueden replicar estas tablas para las variables que indican el voto de las personas encuestadas en las elecciones generales y en el balotaje?

<br></br>

## Imagen de figuras políticas


### Javier Milei

En primer lugar, observamos que la variable "imagen_milei" no es numérica, dado que en la lista de opciones para responder habían palabras como "no sé" y "no lo conozco". Por lo tanto, para calcular una medida númerica de tendencia central como la media o la mediana, necesitamos, primero, convertirla en una variable numérica; esto se logra mediante la función "as.numeric". Luego de esto ya estamos en condiciones de analizar su distribución:

```{r, warning=FALSE, message=FALSE}
datos$imagen_milei = as.numeric(datos$imagen_milei)
summary(datos$imagen_milei)
hist(datos$imagen_milei)
```

### Juan Grabois

El histograma anterior tenía algunas cuestiones de formato que sería conveniente corregir. El título indicaba "Histogram of datos$imagen_milei". Si quisieramos expresarlo en español, y sin las expresiones de código como el símbolo \$, debemos hacer uso del argumento "main" en la función "hist()".

```{r, warning=FALSE, message=FALSE}
datos$imagen_grabois = as.numeric(datos$imagen_grabois)
summary(datos$imagen_grabois)
hist(datos$imagen_grabois, main = "Histograma de la imagen del candidato")
```

### Patricia Bullrich

Si bien en el histograma anterior corregimos el título del gráfico, aún quedan expresiones a corregir en los nombres de los ejes. Si deseamos reemplazar el título del eje vertical de "Frecuency" a "Frecuencia", hacemos uso del argumento "ylab" de la función hist(). De igual manera, si queremos modificar el nombre del eje horizontal, hacemos uso del argumento "xlab" de la función hist(). Finalmente, si deseamos modificar el color de las barras, por ejemplo, hacemos uso del argumento "col" en la función hist().

```{r, warning=FALSE, message=FALSE}
datos$imagen_bullrich = as.numeric(datos$imagen_bullrich)
summary(datos$imagen_bullrich)
hist(datos$imagen_bullrich, main = "Histograma de la imagen de la candidata", ylab =  "Frecuencia", xlab = "Puntaje", col = "lightblue")
```

#### ¿Pueden calcular la imagen para el resto de las figuras políticas?

#### ¿Cuál es la figura con mejor imagen en Córdoba? ¿Y la peor?

<br></br>
<br></br>